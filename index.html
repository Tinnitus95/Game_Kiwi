<!DOCTYPE html>

<head>
	<meta charset="utf-8">
	<title>POI-grab</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		#map {
			height: 100vh;
			width: 100%;
			margin: 1rem 0 1rem 0;
		}

		#messageDiv {
			margin: 0 1rem 1rem 0;
			display: inline;
		}

		#nestButton {
			font-size: 1.5rem;
		}
	</style>
</head>

<body>
	<div id="messageDiv">
	</div>
	<button id="nestButton" onclick="snatchNest()" disabled>Snatch Nest</button>
	<div id="map">
	</div>
	<script>

		function snatchNest() {
			alert("Let's snatch some nest");
		}

		function initMap() {


			// LatLng of a nest
			let nestLatLng = new google.maps.LatLng(59.312962, 18.109841);
			let messageDiv = document.getElementById("messageDiv");
			let distanceToNest = 0;
			let nestButton = document.getElementById("nestButton");

			let yourMarker = new google.maps.Marker(
				{
					icon: './pins/kiwi_icon_blue.png',
					title: 'YOU',
					content: '<h2>YOU</<h2>'
				});
			let myLatLong = new google.maps.LatLng(0, 0);
			// Map options
			let options = {
				zoom: 16,
				center: { lat: 59.312527, lng: 18.061619 }
			};
			let mapDiv = document.getElementById("map");
			let map = new google.maps.Map(mapDiv, options);

			// Array of markers
			let markers = [
				{
					coords: { lat: 59.312962, lng: 18.109841 },
					iconImage: './pins/birds_nest.png',
					content: '<h2>Uninhabitated</h2>',
					title: "Intersection"
				},
				{
					coords: { lat: 59.313249, lng: 18.109766 },
					iconImage: './pins/birds_nest.png',
					content: '<h2>Uninhabitated</h2>',
					title: "Caparol FÃ¤rg"
				},
				{
					coords: { lat: 59.315674, lng: 18.034229 },
					iconImage: './pins/birds_nest.png',
					content: '<h2>Hornstull</h2>',
					title: "Horstulls tunnelbana"
				},
				{
					coords: { lat: 59.317787, lng: 18.050151 },
					iconImage: './pins/pink_MarkerZ.png',
					content: '<h2>Zinkendsdamm</h2>'
				},
				{
					coords: { lat: 59.316988, lng: 18.063240 },
					iconImage: './pins/orange_MarkerM.png',
					content: '<h2>Mariatorget</h2>'
				},
				{
					coords: { lat: 59.319473, lng: 18.072274 },
					iconImage: './pins/green_MarkerS.png',
					content: '<h2>Slussen</h2>'
				},
				{
					coords: { lat: 59.314338, lng: 18.073647 },
					iconImage: './pins/brown_MarkerM.png',
					content: '<h2>Medborgarplatsen</h2>'
				},
				{
					coords: { lat: 59.307866, lng: 18.075900 },
					iconImage: './pins/purple_MarkerS.png',
					content: '<h2>Skanstull</h2>'
				}
			];

			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(sucess);
				navigator.geolocation.watchPosition(showPosition);
			}

			function sucess(pos) {
				let crd = pos.coords;

				map.setZoom(18);

				// Loop through markers 
				for (let i = 0; i < markers.length; i++) {
					// Add marker
					addMarker(markers[i]);
				}
			}

			function addMarker(props) {
				let marker = new google.maps.Marker({
					position: props.coords,
					map: map,
					//icon: props.iconImage
				});

				if (props.title) {
					marker.setTitle(props.title);
				}

				// Check for custom icon
				if (props.iconImage) {
					// Set icon image
					marker.setIcon(props.iconImage);
				}

				if (props.content) {
					let infoWindow = new google.maps.InfoWindow({
						content: props.content
					});

					marker.addListener('click', () => {
						infoWindow.open(map, marker);
					});
				}
			}

			function showPosition(position) {
				//yourLocationDiv.innerHTML = "<h3>Your coordinates</h3>Latitude: " + position.coords.latitude +
				//	"<br>Longitude: " + position.coords.longitude;
				myLatLong = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
				distanceToNest = google.maps.geometry.spherical.computeDistanceBetween(myLatLong, nestLatLng);
				messageDiv.innerHTML = distanceToNest;
				if (distanceToNest < 30) {
					nestButton.disabled = false;
				}
				yourMarker.setPosition(myLatLong);
				map.setCenter(myLatLong);
				yourMarker.setMap(map);
			}
		}

	</script>
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuVpjSaYnMHPb1BryvrFyw2tER5UOsrjs&callback=initMap&libraries=geometry">
	</script>
</body>

</html>